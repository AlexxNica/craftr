# lang.thrift

from craftr.utils import pyutils

import os

def thrift_gen(inputs, gen, outdir=None, debug=False, strict=False, name=None):
  """
  Generate one or more implementations based on Thriftfiles specified with
  *inputs*. The *gen* argument must be a string or a list of strings that
  specify the generator and its options.
  """

  if isinstance(gen, str):
    gen = [gen]

  if not outdir:
    outdir = buildlocal('thrift')
  path.makedirs(outdir)

  builder = TargetBuilder(gtn(name, 'thrift'), inputs=inputs)
  command = [options.bin or os.getenv('THRIFT', 'thrift')]
  command += pyutils.flatten(('--gen', g) for g in gen)
  command += ['-out', outdir]
  if debug:
    command += ['-debug']
  if strict:
    command += ['-strict']
  command += ['$in']

  return builder.build([command])
