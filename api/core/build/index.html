
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../../../assets/images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.0.5">
    
    
      
        <title>build - Craftr v2.0.0.dev7 Documentation</title>
      
    
    
      <script src="../../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application-9c62e3c932.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Craftr v2.0.0.dev7 Documentation" class=" md-icon md-icon--home  md-header-nav__button">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Developer Reference
                </span>
              
                <span class="md-header-nav__parent">
                  core
                </span>
              
            
            build
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-icon md-icon--home  md-nav__button">
      
    </i>
    Craftr v2.0.0.dev7 Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href="../../.." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../../getting-started/" title="Getting Started" class="md-nav__link">
        Getting Started
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../../ref/package/" title="Package Description" class="md-nav__link">
        Package Description
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../../ref/targets/" title="Targets" class="md-nav__link">
        Targets
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../../ref/tasks/" title="Tasks" class="md-nav__link">
        Tasks
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../../ref/loaders/" title="Loaders" class="md-nav__link">
        Loaders
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../../ref/builtins/" title="Built-ins" class="md-nav__link">
        Built-ins
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../../ref/config/" title="Build Configuration" class="md-nav__link">
        Build Configuration
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Developer Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Developer Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" checked>
    
    <label class="md-nav__link" for="nav-4-1">
      core
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4-1">
        core
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="build" class="md-nav__link md-nav__link--active">
      build
    </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../config/" title="config" class="md-nav__link">
        config
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../logging/" title="logging" class="md-nav__link">
        logging
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../manifest/" title="manifest" class="md-nav__link">
        manifest
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../renames/" title="renames" class="md-nav__link">
        renames
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../session/" title="session" class="md-nav__link">
        session
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../platform/" title="platform" class="md-nav__link">
        platform
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      utils
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4-3">
        utils
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/argspec/" title="argspec" class="md-nav__link">
        argspec
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/cson/" title="cson" class="md-nav__link">
        cson
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/httputils/" title="httputils" class="md-nav__link">
        httputils
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/path/" title="path" class="md-nav__link">
        path
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/pyutils/" title="pyutils" class="md-nav__link">
        pyutils
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/shell/" title="shell" class="md-nav__link">
        shell
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/singleton/" title="singleton" class="md-nav__link">
        singleton
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../utils/tty/" title="tty" class="md-nav__link">
        tty
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../defaults/" title="defaults" class="md-nav__link">
        defaults
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../foreignbuild/" title="foreignbuild" class="md-nav__link">
        foreignbuild
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../loaders/" title="loaders" class="md-nav__link">
        loaders
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../targetbuilder/" title="targetbuilder" class="md-nav__link">
        targetbuilder
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../../changes/" title="Changelog" class="md-nav__link">
        Changelog
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../../faq/" title="FAQ" class="md-nav__link">
        FAQ
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../../projects/" title="Projects using Craftr" class="md-nav__link">
        Projects using Craftr
      </a>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
              
                
                <h1 id="craftr.core.build">craftr.core.build</h1>

<h1 id="modcraftrcorebuild">:mod:<code>craftr.core.build</code></h1>
<p>This module provides all the API to generate a Ninja build manifest.</p>
<h2 id="craftr.core.build.Task">Task</h2>

<pre class="codehilite"><code class="language-python">Task(name, func, args)</code></pre>


<p>Represents a task that can be executed via <code>craftr run &lt;task&gt; &lt;args...&gt;</code>.
A task is a Python function that accepts arguments from the command-line.</p>
<h3 id="craftr.core.build.Task.pickle_args">pickle_args</h3>

<pre class="codehilite"><code class="language-python">Task.pickle_args(args)</code></pre>


<p>Converts a list of arguments that may contain Python objects to a list of
plain strings containing only printable characters. Python objects are
pickled, compressed and then encoded in base64.</p>
<h3 id="craftr.core.build.Task.unpickle_args">unpickle_args</h3>

<pre class="codehilite"><code class="language-python">Task.unpickle_args(args)</code></pre>


<p>Reverts :meth:<code>pickle_args</code>.</p>
<h2 id="craftr.core.build.Target">Target</h2>

<pre class="codehilite"><code class="language-python">Target(name, commands, inputs, outputs, implicit_deps=(), order_only_deps=(), pool=None, deps=None, depfile=None, msvc_deps_prefix=None, explicit=False, foreach=False, description=None, metadata=None, cwd=None, environ=None, frameworks=(), task=None, runprefix=None)</code></pre>


<p>A higher level abstraction of a Target that can be added to a :class:<code>Graph</code>
and then exported into a Ninja build manifest. A target should be treated
as read-only always.</p>
<h3 id="craftr.core.build.Target.generates_build_instruction">generates_build_instruction</h3>

<p>Reading this property tells you whether the target produces at least one
build in the Ninja manifest. This is used to determine whether a target is
included in the list of default targets or not.</p>
<h3 id="craftr.core.build.Target.export">export</h3>

<pre class="codehilite"><code class="language-python">Target.export(writer, context, platform)</code></pre>


<p>Export the target to a Ninja manifest.</p>
<h2 id="craftr.core.build.PlatformHelper">PlatformHelper</h2>

<pre class="codehilite"><code class="language-python">PlatformHelper(*args, **kwargs)</code></pre>


<p>Interface to abstract platfrom dependent operations during the export
process.</p>
<h3 id="craftr.core.build.PlatformHelper.format_env_ref">format_env_ref</h3>

<pre class="codehilite"><code class="language-python">PlatformHelper.format_env_ref(envvar)</code></pre>


<p>Given the name of an environment variable, return a new string that
references that environment variable in the syntax of this platform's
shell.</p>
<h3 id="craftr.core.build.PlatformHelper.replace_argument_inout_vars">replace_argument_inout_vars</h3>

<pre class="codehilite"><code class="language-python">PlatformHelper.replace_argument_inout_vars(arg, inputs, outputs)</code></pre>


<p>Helper function for :meth:<code>write_command_file</code> to replace the <code>$in</code>
and <code>$out</code> variables in a command argument <em>arg</em> with the specified
<em>inputs</em> and <em>outputs</em>.</p>
<h3 id="craftr.core.build.PlatformHelper.replace_commands_inout_vars">replace_commands_inout_vars</h3>

<pre class="codehilite"><code class="language-python">PlatformHelper.replace_commands_inout_vars(commands, inputs, outputs)</code></pre>


<p>Applies :meth:<code>replace_argument_inout_vars</code> to all <em>commands</em>.</p>
<h3 id="craftr.core.build.PlatformHelper.prepare_single_command">prepare_single_command</h3>

<pre class="codehilite"><code class="language-python">PlatformHelper.prepare_single_command(command, cwd)</code></pre>


<p>Given a single command as a list of strings and an optional working
directory path, return an updated list of strings that serves as the
new command including the current working directory switch.</p>
<h3 id="craftr.core.build.PlatformHelper.write_command_file">write_command_file</h3>

<pre class="codehilite"><code class="language-python">PlatformHelper.write_command_file(filename, commands, inputs=None, outputs=None, cwd=None, environ=None, foreach=False, suffix=Default, dry=False, accept_additional_args=False)</code></pre>


<p>Writes a file that can be run by the native shell to execute the <em>commands</em>.
If <em>suffix</em> is omitted, the default script suffix for the shell will be
appended (which is especially important on Windows).</p>
<p>References to <code>$in</code> and <code>$out</code> will be replaced by the values of
<em>inputs</em> and <em>outputs</em> if they are specified. Note that in a concatenated
context (eg. <code>$out.d</code>) the number input or output files (respectively)
must be exactly one, otherwise an error is raised.</p>
<p>If <em>foreach</em> is specified, the generated command file accepts two
command-line arguments for the input and output file. Note that references
to <code>$in</code> and <code>$out</code> will then be replaced by the respective placeholder
in the shells scripting language and the <em>inputs</em> and <em>outputs</em> parmaeters
are ignored.</p>
<p>If <em>accept_additional_args</em> is True, the last command in <em>commands</em> must
accept forward arguments passed to the shell script.</p>
<p>Returns 1) a list of strings that represents the command to execute the
script. If <em>foreach</em> is specified, the two last items of the returned list
will be <code>['$in', '$out']</code>. 2) The actual filename that has been created.</p>
<h3 id="craftr.core.build.PlatformHelper.prepare_commands">prepare_commands</h3>

<pre class="codehilite"><code class="language-python">PlatformHelper.prepare_commands(commands)</code></pre>


<p>Passed a list of list of strings that represents the commands for
a target. Return the same value or a modified value.</p>
<h2 id="craftr.core.build.Tool">Tool</h2>

<pre class="codehilite"><code class="language-python">Tool(name, command, preamble=None, environ=None)</code></pre>


<p>This class represents a program that can be called by by the command in
build rules. Usually this is only necessary if the tool requires a special
environment.</p>
<p>Depending on whether its necessary on the current platform, tools might be
exported into shell scripts. The actual command to be called in the command
can then be retrieved by converting the :class:<code>Tool</code> object to a string.</p>
<p>.. attribute:: name</p>
<p>The name of the tool. In a build :class:<code>Graph</code>, there may only be one tool
  associated with the same name.</p>
<p>.. attribute:: command</p>
<p>The command that is to be executed and to which the additional command-line
  arguments are forwarded to. Must be a list of strings.</p>
<p>.. attribute:: preamble</p>
<p>A list of commands/files that are to be sourced before the :attr:<code>command</code>
  can be executed.</p>
<p>.. attribute:: environ</p>
<p>A dictionary of environment variables that will be exported before the
  command or premable is executed.</p>
<p>.. attribute:: exported_command</p>
<p>After :meth:<code>exported_command</code> has been called, this member contains the
  command that was exported for the Tool. This is a single string.</p>
<h2 id="craftr.core.build.DuplicateOutputError">DuplicateOutputError</h2>

<pre class="codehilite"><code class="language-python">DuplicateOutputError(filename, new_target, target)</code></pre>


<p>This exception is raised if the same output file would be built by
multiple targets.</p>
<h2 id="craftr.core.build.Graph">Graph</h2>

<pre class="codehilite"><code class="language-python">Graph()</code></pre>


<p>This class represents the whole build graph which is generated from
targets reference input and output files. After a :class:<code>Target</code> is
created, it must be added to a Graph with the :meth:<code>add_target</code> method.</p>
<p>Note that all filenames in the Graph are absolute and normalized with
the :func:<code>path.norm</code> function.</p>
<p>.. attribute:: tasks</p>
<p>Read-only. A dictionary of all :class:<code>Tasks&lt;Task&gt;</code> that have been
  added to the Graph.</p>
<p>.. attribute:: target</p>
<p>Read-only. A dictionary of all the :class:<code>Targets&lt;Target&gt;</code> that have
  been added to the Graph.</p>
<p>.. attribute:: infiles</p>
<p>Read-only. A dictionary that maps normalized filenames of input files
  to a list of :class:<code>Targets&lt;Target&gt;</code>.</p>
<p>.. attribute:: outfiles</p>
<p>Read-only. A dictionary that maps normalized filenames of output files
  to the :class:<code>Target</code> that creates it.</p>
<p>.. attributes:: vars</p>
<p>A dictionary of variables that will be exported to the Ninja manifest.</p>
<h3 id="craftr.core.build.Graph.add_task">add_task</h3>

<pre class="codehilite"><code class="language-python">Graph.add_task(task, **kwargs)</code></pre>


<p>Add a :class:<code>Task</code> to the Graph. Creates a :class:<code>Target</code> for the task
and returns it.</p>
<p>:param task: The :class:<code>Task</code> to add to the Graph.
:param kwargs: Additional parameters for the :class:<code>Target</code> constructor.</p>
<h3 id="craftr.core.build.Graph.add_tool">add_tool</h3>

<pre class="codehilite"><code class="language-python">Graph.add_tool(tool)</code></pre>


<p>Add a :class:<code>Tool</code> to the Graph.</p>
<p>:raise ValueError: If the :attr:<code>Tool.name</code> is already used.</p>
<h3 id="craftr.core.build.Graph.add_target">add_target</h3>

<pre class="codehilite"><code class="language-python">Graph.add_target(target)</code></pre>


<p>Add a :class:<code>Target</code> to the Graph.</p>
<p>.. note:: For performance reasons, this method assumes that all paths
          in the <em>target</em> are already normalized with :meth:<code>path.norm</code>.</p>
<p>:raise ValueError: If the :attr:<code>Target.name</code> is already used.
:raise DuplicateOutputError: If the <em>target</em> lists an output file that
  is already created by another target.</p>
<h3 id="craftr.core.build.Graph.export">export</h3>

<pre class="codehilite"><code class="language-python">Graph.export(writer, context, platform)</code></pre>


<p>Export the build graph to a Ninja manifest.</p>
<p>:param writer: A :class:<code>ninja_syntax.Writer</code> object.
:param context: A :class:<code>ExportContext</code> object.
:param platform: A :class:<code>PlatformHelper</code> instance.</p>
<h2 id="craftr.core.build.ExportContext">ExportContext</h2>

<pre class="codehilite"><code class="language-python">ExportContext(ninja_version)</code></pre>


<p>An instance of this class is required for :meth:<code>Graph.export</code> and
:meth:<code>Target.export</code>. It provides additional information that can influence
the exported manifest.</p>
<p>.. attribute:: ninja_version</p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../ref/config/" title="Build Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Build Configuration
              </span>
            </div>
          </a>
        
        
          <a href="../config/" title="config" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                config
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application-f7ac33b6fb.js"></script>
      <script>app.initialize({url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>