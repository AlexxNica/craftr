<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Tasks - Welcome to the Craftr Documentation!</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Tasks";
    var mkdocs_page_input_path = "tasks.md";
    var mkdocs_page_url = "/tasks/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Welcome to the Craftr Documentation!</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../changes/">Changelog</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Reference</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/">Getting Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../config/">Build Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../builtins/">Built-ins</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../loaders/">Loaders</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Tasks</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#tasks">Tasks</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../generators/">Generators</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../transition/">Transition from Craftr 1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../faq/">FAQ</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Welcome to the Craftr Documentation!</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Reference &raquo;</li>
        
      
    
    <li>Tasks</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="tasks">Tasks</h1>
<p>Craftr allows you to embed actual Python functions into the build process. We
call this concept "tasks". Tasks end up being plain rules and build instructions
in the Ninja manifest. They will then be invoked using the <code>craftr run</code> command.
Note that for each task that is executed, your build-script is also executed
another time.</p>
<p>You can build functions that create tasks, so you can create multiple instances
of the same task with different inputs, or you just create a task once from a
single function.</p>
<p><strong>A simple example</strong></p>
<pre><code class="python">git = load('craftr.utils.git').Git(project_dir)  # Git repository helper for this project

@task(outputs = [buildlocal('include/gitversion.h')])
def gitversion(inputs, outputs):
    with open(outputs[0], 'w') as fp:
      fp.write('#pragma once\n'
              '#define GITVERSION &quot;{}&quot;\n'
        .format(git.describe()))
</code></pre>

<p>We can then compile a C-program that includes the generated <code>gitversion.h</code>
file, but we must ensure that the task is executed <em>before</em> the C-program
is compiled.</p>
<pre><code class="python">cxx = load('craftr.lang.cxx')
app = cxx.binary(
  output = 'main',
  inputs = cxx.c_compile(
    sources = glob(['src/*.c']),
    include = [buildlocal('include')]
  ) &lt;&lt; gitversion
)
</code></pre>

<p><strong>Task generators</strong></p>
<p>We can generalise the <code>gitversion</code> task so it can be used multiple times.</p>
<pre><code class="python">Git = load('craftr.utils.git').Git  # Git repository helper for this project

def write_gitversion(project_dir = None):
  if not project_dir:
    project_dir = session.module.project_dir
  git = Git(project_dir)

  def worker(inputs, outputs):
    with open(outputs[0], 'w') as fp:
      fp.write('#pragma once\n'
              '#define GITVERSION &quot;{}&quot;\n'
        .format(git.describe()))

  outputs = [buildlocal('include/gitversion.h')]
  return gentask(worker, outputs = outputs, name = gtn())

gitversion = write_gitversion()
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../generators/" class="btn btn-neutral float-right" title="Generators">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../loaders/" class="btn btn-neutral" title="Loaders"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../loaders/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../generators/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
